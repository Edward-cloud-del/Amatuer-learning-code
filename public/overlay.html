<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>FrameSense Overlay</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            overflow: hidden;
        }

        .overlay-container {
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 16px 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px #00ff88;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .overlay-text {
            color: white;
            font-size: 16px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .capture-button {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .capture-button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .capture-button:active {
            transform: translateY(0);
        }

        /* Transparent mode - make everything transparent and clickable */
        .transparent-mode {
            background: rgba(255, 0, 0, 0.05) !important;
            cursor: crosshair !important;
        }

        .hidden {
            display: none !important;
        }

        /* Drag selection box */
        .selection-box {
            position: absolute;
            border: 2px dashed #00ff88;
            background: rgba(0, 255, 136, 0.1);
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body>
    <div class="overlay-container" id="container">
        <div class="status-indicator"></div>
        <div class="overlay-text" id="text">Ready to capture</div>
        <button class="capture-button" id="captureBtn">ðŸ“¸ Start Capture</button>
    </div>

    <div class="selection-box" id="selectionBox"></div>

    <script>
        console.log('FrameSense overlay loading...');
        
        let isTransparentMode = false;
        let isSelecting = false;
        let startX, startY;

        // Capture button handler
        document.getElementById('captureBtn').onclick = async function() {
            console.log('Opening selection overlay window...');
            try {
                // Call Tauri backend to open selection overlay
                await window.__TAURI__.invoke('open_selection_overlay');
                console.log('Selection overlay opened successfully');
                // Close this overlay window
                window.close();
            } catch (error) {
                console.error('Failed to open selection overlay:', error);
                // Fallback to local transparent mode
                startTransparentCapture();
            }
        };

        function startTransparentCapture() {
            isTransparentMode = true;
            
            // Hide the container
            document.getElementById('container').classList.add('hidden');
            
            // Make body transparent and ready for selection
            document.body.classList.add('transparent-mode');
            
            // Add mouse event listeners for drag selection
            document.body.addEventListener('mousedown', startSelection);
            document.body.addEventListener('mousemove', updateSelection);
            document.body.addEventListener('mouseup', endSelection);
            
            console.log('Transparent mode active - drag to select area');
        }

        function startSelection(event) {
            if (!isTransparentMode) return;
            
            isSelecting = true;
            startX = event.clientX;
            startY = event.clientY;
            
            const selectionBox = document.getElementById('selectionBox');
            selectionBox.style.left = startX + 'px';
            selectionBox.style.top = startY + 'px';
            selectionBox.style.width = '0px';
            selectionBox.style.height = '0px';
            selectionBox.style.display = 'block';
            
            console.log('Selection started at:', startX, startY);
        }

        function updateSelection(event) {
            if (!isSelecting) return;
            
            const currentX = event.clientX;
            const currentY = event.clientY;
            
            const left = Math.min(startX, currentX);
            const top = Math.min(startY, currentY);
            const width = Math.abs(currentX - startX);
            const height = Math.abs(currentY - startY);
            
            const selectionBox = document.getElementById('selectionBox');
            selectionBox.style.left = left + 'px';
            selectionBox.style.top = top + 'px';
            selectionBox.style.width = width + 'px';
            selectionBox.style.height = height + 'px';
        }

        function endSelection(event) {
            if (!isSelecting) return;
            
            isSelecting = false;
            
            const endX = event.clientX;
            const endY = event.clientY;
            
            const left = Math.min(startX, endX);
            const top = Math.min(startY, endY);
            const width = Math.abs(endX - startX);
            const height = Math.abs(endY - startY);
            
            console.log('Selection completed:', { left, top, width, height });
            
            // Show success message
            alert(`Capture area selected!\nPosition: (${left}, ${top})\nSize: ${width} x ${height}px`);
            
            // Reset to normal mode
            resetOverlay();
        }

        function resetOverlay() {
            console.log('Resetting overlay...');
            
            isTransparentMode = false;
            isSelecting = false;
            
            // Hide selection box
            document.getElementById('selectionBox').style.display = 'none';
            
            // Remove transparent mode
            document.body.classList.remove('transparent-mode');
            document.getElementById('container').classList.remove('hidden');
            
            // Remove event listeners
            document.body.removeEventListener('mousedown', startSelection);
            document.body.removeEventListener('mousemove', updateSelection);
            document.body.removeEventListener('mouseup', endSelection);
        }

        // ESC to reset
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                console.log('ESC pressed - resetting overlay');
                resetOverlay();
            }
        });

        console.log('FrameSense overlay ready!');
    </script>
</body>
</html> 